<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" media="screen and(max width:768)" href="style/mobile.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <script src="https://kit.fontawesome.com/bf77ad3b6f.js" crossorigin="anonymous"></script>
    <title>Dodaj klasy</title>
</head>

<body id="add-class">
    <nav class="main-nav">
        <div class="container">
            <div class="logo">
                <h1>LOGO</h1>
            </div>
            <div class="nav">
                <ul>
                    <li>
                        <div class="user">
                            <h1>Tomek</h1>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="tittle-container">
        <h1>Dodaj klasę</h1>
    </header>
    <section id="add">
        <div class="container">

            <div class="card-container">
                <div class="card-tittle">
                    <ul>
                        <li>KOD</li>
                    </ul>
                </div>
               <!--<form action="#" id="class-ad">--> 
                <ul class="ul-add green-shadow">
                    <li> <input type="text" id="name" name="name" placeholder="Kod"></li>
                    <li>
                        <div class="btn-container">
                            <button class="btn btn-dark" id="addNewClass" type="submit" value="DODAJ">DODAJ </button>
                        </div>
                    </li>
                    <li class="addStudent dark-shadow">
                        <input type="text" id="imie" placeholder="Imie">
                        <input type="text" id="nazwisko" placeholder="Nazwisko">
                        <div class="btn-container"><button id="addNew" type="submit" class="btn btn-dark"> DODAJ </button></div>
                    </li>
                    <li class="studentListContainer">
                        <div id="studentList">
                           <!--from js-->
                        </div>
                    </li>

                    <li id="liczba">
                        <p>Liczba dodanych uczniów: 0</p>
                    </li>
                    <li>
                        <div class="btn-container"><button id="submitNewClass" type="submit" class="btn btn-dark"> DODAJ KLASE </button></div>
                    </li>
                </ul>
                <div class="under-tittle-container">
                    <h6>Dodane klasy</h>
                </div>
                <div class="all-seperate">
                   
                </div>
                   
                <div class="btn-container-center">
                  <!--<a class="btn btn-dark" href="index.html">-->  
                    <button id="submitAllClass" class="btn btn-dark">
                        <p>ZAPISZ</p><a href="index.html"></a>
                    </button>

                </div>
          <!--</form>-->  
            </div>
        </div>
    </section>
    <footer>
        <p>LOREM IPSUM</p>
    </footer>


    <script>

        var studentId = 0;
        var studentsList = [];
        class Student {  
        
            constructor(imie, nazwisko) {
                this.id = studentId++;
                this.imie = imie;
                this.nazwisko = nazwisko;
            }


            get Imie(){
                return this.imie;
            }
            get Nazwisko(){
                return this.nazwisko;
            }
            get Id(){
                return this.id;
            }

            
        }

        var classID = 0 ;
        let classesList = [];

        class Class{
            constructor(name){
                this.id = classID++;
                this.name=name;
                this.studentsArr = [];
            }
            newStudent(imie, nazwisko){
            let s = new Student(imie, nazwisko);
            this.studentsArr.push(s);
            return s;
            }

            allStudents(){
             return this.studentsArr
            }

            get numberOfPlayers(){
            return this.studentsArr.length
            }

            ChangeName(name){
                this.name=name;
            }

            Clear(){
                this.studentsArr = [];
            }

            Reset(){
                this.name=tmp;
                this.id=classID++;
                this.studentsArr = [];
            }

        }

        class UI {
            static displayStudents(){
            }  

            static addStudentToList(student){

                const list = document.querySelector('#studentList');
                
                const row = document.createElement('ul');
                
                row.innerHTML = `
               <li >  ${student.imie} ${student.nazwisko}</li>
              
               <li><div class="btn-container">
               <input id=${student.id} class="btn btn-dark delete" type="submit" value="USUŃ">
               </div></li>  
            `;
            row.addEventListener('click' ,(e) => {
                    UI.deleteStudent(e.target);
                    let I= e.target.id;
                     for( var i = 0; i < studentsList.length; i++){ 
                         if ( studentsList[i].Id == I) 
                         {
                        studentsList.splice(i, 1);
                        console.log(studentsList) 
                         }
                     }});

          list.appendChild(row);
            }

            static clearFields(){
                document.querySelector('#imie').value= '';
                document.querySelector('#nazwisko').value= '';

            }

            clearAllFields(){
                document.querySelector('#imie').value= '';
                document.querySelector('#nazwisko').value= '';
                document.querySelector('#name').value ='';
                const row = document.querySelector('#studentList');
                row.innerHTML = '';
            }

            static displayClasses(){

                var tmp = new Class("tmp");
                    tmp.ChangeName("1b");
                    tmp.newStudent("Tomek", "Guz");
                    tmp.newStudent("Ola", "Guz");
                UI.addClassToList(tmp);

                tmp.Clear();
            }

            static addClassToList(klasa){

                const list2 = document.querySelector('.all-seperate');
                const row2 = document.createElement('button');
                row2.className = "unhiden_item dark-shadow";
                row2.id=klasa.id+"item";

                row2.innerHTML= `

                <ul class="item">
                            <li>
                            <p>${klasa.name}</p>
                            </li>
                            <li>
                                <div class="btn-container">
                                 <input id=${klasa.id} class="btn btn-dark delete" type="submit" value="USUŃ">
                                </div>
                            </li>
                 </ul>
                `;            
            row2.addEventListener("click", function() {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) {
              panel.style.maxHeight = null;
            } else {
              panel.style.maxHeight = panel.scrollHeight + "px";
            }});

              //usuwanie nauczyciela i update tablicy nauczyciela, usuniecie schowanego panelu
            
            row2.addEventListener('click' ,(e) => {
                   
                    UI.deleteClass(e.target);
                    let s= e.target.id;
                    
                    UI.deletePanel(e.target,s);
                    for( var i = 0; i < classesList.length; i++){ 
                         if ( classesList[i].id == s) 
                        {  classesList.splice(i, 1); }
                     }

                     localStorage.setItem('MyClasses', JSON.stringify(classesList));
      
             });

                list2.appendChild(row2);

                const row3=document.createElement('div');
                row3.className='panel';
                row3.id=klasa.id+"panel";

                const row4 = document.createElement('div');
                row4.id='studentList';
                let i;
                for(i=0; i<klasa.studentsArr.length; i++){
                const row5 = document.createElement('ul');
                    row5.innerHTML= `
                    
                    <li>${klasa.studentsArr[i].Imie} ${klasa.studentsArr[i].Nazwisko}</li>
                    <li>
                    <div class="btn-container">
                    <input id=${klasa.studentsArr[i].id} class="btn btn-dark  delete" type="submit" value="USUŃ">
                     </div>
                     </li>
                    
                    `;
                    
                    row5.addEventListener('click' ,(e) => {
                    UI.deleteStudent(e.target);
                    let I= e.target.id;
                     for( var i = 0; i < klasa.studentsArr.length; i++){ 
                         if ( klasa.studentsArr[i].Id == I) 
                        {  klasa.studentsArr.splice(i, 1); }
                     }
    
                      
         
                     localStorage.setItem('MyClasses', JSON.stringify(classesList));
                  });
                    row4.appendChild(row5);
                }
                
                row3.appendChild(row4);
                
                list2.appendChild(row3);
            }
        
            static deleteStudent(element){
                if(element.classList.contains('delete'))
                element.parentElement.parentElement.parentElement.remove();
            }

            static deleteClass(element){
                if(element.classList.contains('delete')){
                element.parentElement.parentElement.parentElement.remove();  
                }
              
            }

            static deletePanel(element, id){
                if(element.classList.contains('delete')){
                var el = document.getElementById(id+"panel");
                el.remove();
                var e = document.getElementById(id+"item");
                e.remove();
                }
            }
        }

       

        var addNew = document.querySelector('#addNew');
        addNew.addEventListener('click', (e) => {
            e.preventDefault();
            //const t = document.querySelector("#liczba");
            //t.style.visibility = "visible"; 
            const element = document.querySelector("#submitNewClass");
            element.style.visibility = "visible";

            const k = document.querySelector(".studentListContainer");
            k.style.visibility = "visible";
            k.style.height="min-content";

            const imie = document.querySelector('#imie').value;
            const nazwisko = document.querySelector('#nazwisko').value;
        
            student = new Student(imie, nazwisko);

            studentsList.push(student);

            UI.addStudentToList(student);
           
            UI.clearFields();
        });

        var addNewClass = document.querySelector('#addNewClass');
        addNewClass.addEventListener('click', (e) => {
            e.preventDefault();
           
            const element = document.querySelector(".addStudent");
            element.style.visibility = "visible";
            element.style.height=element.scrollHeight + 10 + "px" ;
            const k = document.querySelector("#addNewClass");
            k.style.visibility = "hidden";
            const s = document.querySelector("#submitNewClass");
            s.style.visibility = "hidden";
        });

        var addNewClass = document.querySelector('#submitNewClass');
        submitNewClass.addEventListener('click', (e) => {
            e.preventDefault();
           
            const name = document.querySelector('#name').value;
           // const studentsArr = document.querySelector('#nazwisko').value;

            let newclass = new Class(name);

            studentsList.forEach(student => {
                newclass.newStudent(student.Imie, student.Nazwisko);

            const s = document.querySelector("#submitNewClass");
            s.style.visibility = "hidden";
                
            });
            classesList.push(newclass);

            localStorage.setItem('MyClasses', JSON.stringify(classesList));

            UI.addClassToList(newclass);

            const k = document.querySelector(".studentListContainer");
            k.style.visibility = "hidden";
            k.style.height= 0;
            const s = document.querySelector("#addNewClass");
            s.style.visibility = "visible";
            const element = document.querySelector(".addStudent");
            element.style.visibility = "hidden";
          
            var targetDiv = document.getElementById("name")
            targetDiv.value ='';
            studentsList=[];

            const row = document.querySelector('#studentList');
                row.innerHTML = '';

        });

    </script>

</body>

</html>